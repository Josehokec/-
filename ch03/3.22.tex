\problem{证明引理3.39.}

引理3.39表述为:

存在一般递归函数$\mathrm{var,app,abs,num}:\mathbb{N}\to\mathbb{N}$使得:
\begin{enumerate}[label=(\arabic*)]
    \item $\forall n\in\mathbb{N}. \mathrm{var}(n)=\sharp (v^{(n)});$\label{def:var}
    \item $\forall M, N\in \Lambda. \mathrm{app}(\sharp M,\sharp N)=\sharp (MN);$\label{def:app}
    \item $\forall x\in\nabla, M\in\Lambda. \mathrm{abs}(\sharp x, \sharp M) = \sharp(\lambda x. M);$]\label{def:abs}
    \item $\forall n\in\mathbb{N}. \text{num}(n)=\sharp\churchnumber{n}.$
\end{enumerate}

\begin{proof}{\color {red} {对第一版答案进行了补充说明.}}取$[x,y]=2^x \cdot 3^y, \Pi_1=ep_1, \Pi_2=ep_1$,从而$[\cdot,\cdot],\Pi_1,\Pi_2 \in \EF$.

\begin{enumerate}[label=(\arabic*)]
    \item 由于$v^{(n)}=[0,n] \in \EF$, 取var($n$)=$[0,n]$即可;
    \item 取app($m,n$)=$[1,[m,n]] \in \EF$, 则$\text{app}(\sharp M,\sharp N)=\sharp (MN)$;
    \item 取abs($n,m$)=$[2,[\text{var}(n),m]] \in \EF$, 易验证$\text{abs}(\sharp v^{(n)}, \sharp M) = \sharp(\lambda v^{(n)}. M)$;
    \item 下面证$\forall n\in\mathbb{N}. \text{num}(n)=\sharp\churchnumber{n}$,且num$(n)$是递归的:
        $$\begin{aligned}
          \churchnumber{n+1}&=\sharp(\lambda fx. f^{n+1}x)\\
          &=\Big[2, \Big[\sharp f, [2, [\sharp x, \sharp f^{n+1}x]]\Big]\Big]\\
          &=\Big[2, \Big[\sharp f, \big[2, \big[\sharp x, [1,[\sharp f, \sharp f^n x]]\big]\big]\Big]\Big]
        \end{aligned}$$
        
        $$\begin{aligned}
          \churchnumber{n}&=\sharp(\lambda fx. f^{n}x)\\
          &=\Big[2, \Big[\sharp f, [2, [\sharp x, \sharp f^{n}x]]\Big]\Big]\\
        \end{aligned}$$
        故有：
        $$\sharp f^{n}x = \Pi_2(\Pi_2(\Pi_2(\Pi_2(\sharp \churchnumber{n}))))=\Pi_2^4(\sharp \churchnumber{n})$$
        于是
        $$\churchnumber{n+1} = \Big[2, \Big[\sharp f, \big[2, \big[\sharp x, [1,[\sharp f, \Pi_2^4(\sharp \churchnumber{n})]]\big]\big]\Big]\Big]$$
        令$h(z) = \Big[2, \Big[\sharp f, \big[2, \big[\sharp x, [1,[\sharp f, \Pi_2^4(z)]]\big]\big]\Big]\Big]$,$\text{num}(0)=\churchnumber{0}$,于是:
        $$\text{num}(n+1)=h(\text{num}(n))$$
        因此num $\in \PRF$,$\text{num}(n)=\churchnumber{n}$.
    
\end{enumerate}

\end{proof}